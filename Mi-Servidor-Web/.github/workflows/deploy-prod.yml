name: Despliegue Producci칩n (Windows)

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: self-hosted  # <--- Esto usa TU Windows
    steps:
      - name: Bajar c칩digo
        uses: actions/checkout@v3

      - name: Desplegar en Docker
        shell: powershell
        run: |
          Write-Host "--- INICIANDO DESPLIEGUE PROD ---"
          
          # 1. Construir la imagen (Meter archivos dentro de la caja)
          docker build -t mi-web-prod:latest .

          # 2. Limpiar contenedor viejo si existe
          # Usamos try/catch simplificado o comprobaci칩n b치sica
          $container = docker ps -a -q -f name=web-prod
          if ($container) {
              docker stop web-prod
              docker rm web-prod
          }

          # 3. Arrancar nuevo contenedor en puerto 8080
          docker run -d --name web-prod -p 8080:80 mi-web-prod:latest